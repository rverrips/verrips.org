<?php

//  PROJECT HONEY POT ADDRESS DISTRIBUTION SCRIPT
//  For more information visit: http://www.projecthoneypot.org/
//  Copyright (C) 2004-2010, Unspam Technologies, Inc.
//
//  This program is free software; you can redistribute it and/or modify
//  it under the terms of the GNU General Public License as published by
//  the Free Software Foundation; either version 2 of the License, or
//  (at your option) any later version.
//
//  This program is distributed in the hope that it will be useful,
//  but WITHOUT ANY WARRANTY; without even the implied warranty of
//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//  GNU General Public License for more details.
//
//  You should have received a copy of the GNU General Public License
//  along with this program; if not, write to the Free Software
//  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
//  02111-1307  USA
//
//  If you choose to modify or redistribute the software, you must
//  completely disconnect it from the Project Honey Pot Service, as
//  specified under the Terms of Service Use. These terms are available
//  here:
//
//  http://www.projecthoneypot.org/terms_of_service_use.php
//
//  The required modification to disconnect the software from the
//  Project Honey Pot Service is explained in the comments below. To find the
//  instructions, search for:  *** DISCONNECT INSTRUCTIONS ***
//
//  Generated On: Thu, 23 Dec 2010 09:24:37 -0800
//  For Domain: verrips.org
//
//

//  *** DISCONNECT INSTRUCTIONS ***
//
//  You are free to modify or redistribute this software. However, if
//  you do so you must disconnect it from the Project Honey Pot Service.
//  To do this, you must delete the lines of code below located between the
//  *** START CUT HERE *** and *** FINISH CUT HERE *** comments. Under the
//  Terms of Service Use that you agreed to before downloading this software,
//  you may not recreate the deleted lines or modify this software to access
//  or otherwise connect to any Project Honey Pot server.
//
//  *** START CUT HERE ***
//
define('__REQUEST_HOST', 'hpr9.projecthoneypot.org');
define('__REQUEST_PORT', '80');
define('__REQUEST_SCRIPT', '/cgi/serve.php');
//
//  *** FINISH CUT HERE ***
//

define('__HPOT_TAG1', '4d83c6d0c3d4166b0c74c9041df44fe7');
define('__HPOT_TAG2', 'b2a3f26d0a1c92ee054c4038ddc3d061');
define('__HPOT_TAG3', '34aa2473d1aa4705f92165addfe297ff');

define('__CLASS_STYLE_1', 'japoprir');
define('__CLASS_STYLE_2', 'chegost');

define('__DIV1', '5edr8b');

define('__VANITY_L1', 'MEMBER OF PROJECT HONEY POT');
define('__VANITY_L2', 'Spam Harvester Protection Network');
define('__VANITY_L3', 'provided by Unspam');

define('__DOC_TYPE1', '<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">\n');
define('__HEAD1', '<html>\n<head>\n');
define('__HEAD2', '<title>http://verrips.org</title>\n</head>\n');
define('__ROBOT1', '<meta name="robots" content="noarchive,noindex,follow">\n');
define('__NOCOLLECT1', '<meta name="no-email-collection" content="/">\n');
define('__TOP1', '<body>\n<div align="center">\n');
define('__EMAIL1A', '<a href="mailto:');
define('__EMAIL1B', '" style="display: none;">');
define('__EMAIL1C', '</a>');
define('__EMAIL2A', '<a href="mailto:');
define('__EMAIL2B', '" style="display:none;">');
define('__EMAIL2C', '</a>');
define('__EMAIL3A', '<a style="display: none;" href="mailto:');
define('__EMAIL3B', '">');
define('__EMAIL3C', '</a>');
define('__EMAIL4A', '<a style="display:none;" href="mailto:');
define('__EMAIL4B', '">');
define('__EMAIL4C', '</a>');
define('__EMAIL5A', '<a href="mailto:');
define('__EMAIL5B', '"></a>');
define('__EMAIL5C', '..');
define('__EMAIL6A', '<span style="display: none;"><a href="mailto:');
define('__EMAIL6B', '">');
define('__EMAIL6C', '</a></span>');
define('__EMAIL7A', '<span style="display:none;"><a href="mailto:');
define('__EMAIL7B', '">');
define('__EMAIL7C', '</a></span>');
define('__EMAIL8A', '<!-- <a href="mailto:');
define('__EMAIL8B', '">');
define('__EMAIL8C', '</a> -->');
define('__EMAIL9A', '<div id="'.__DIV1.'"><a href="mailto:');
define('__EMAIL9B', '">');
define('__EMAIL9C', '</a></div><br><script language="JavaScript" type="text/javascript">document.getElementById(\''.__DIV1.'\').innerHTML=\'\';</script>');
define('__EMAIL10A', '<a href="mailto:');
define('__EMAIL10B', '"><!-- ');
define('__EMAIL10C', ' --></a>');
define('__LEGAL1', '');
define('__LEGAL2', '\n');
define('__STYLE1', '\n<style>a.'.__CLASS_STYLE_1.'{color:#FFF;font:bold 10px arial,sans-serif;text-decoration:none;}</style>');
define('__VANITY1', '<table cellspacing="0"cellpadding="0"border="0"style="background:#999;width:230px;"><tr><td valign="top"style="padding: 1px 2px 5px 4px;border-right:solid 1px #CCC;"><span style="font:bold 30px arial,sans-serif;color:#666;top:0px;position:relative;">@</span></td><td valign="top" align="left" style="padding:3px 0 0 4px;"><a href="http://www.projecthoneypot.org/" class="'.__CLASS_STYLE_1.'">'.__VANITY_L1.'</a><br><a href="http://www.unspam.com"class="'.__CLASS_STYLE_1.'">'.__VANITY_L2.'<br>'.__VANITY_L3.'</a></td></tr></table>\n');
define('__BOTTOM1', '</div>\n</body>\n</html>\n');

function getLegalContent()
{
    return '<table border="0" cellpadding="0" cellspacing="0">\n<tr>\n<td><font style="font-family: courier, monospace;">&nbsp; <b><font color=white>h</font></b>&nbsp; &nbsp;&nbsp; <br><font color=white>o</font><br>The webs<br>to you<font color=white>h</font>s<br>other<font color=white>e</font>te<br>Web&#115;&#105;&#116;e <br>read the<br>agents &#111;<br>them.<font color=white>d</font>Th<br>non-tra&#110;<br>Web&#115;ite.<br><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;<br>Special <br>No&#110;-Hum&#97;<br>sp&#105;ders&#44;<br>pro&#103;r&#97;ms<br>automati<br><br>Email ad<br>I&#116; is r&#101;<br>al&#111;ne. Y<br>has a va<br>st&#111;rage,<br>value of<br>&#115;torin&#103; <br>a&#103;re&#101;&#109;en<br><br><b><font color=white>d</font></b>&nbsp; &nbsp; &nbsp;&nbsp; <br><font color=white>h</font><br>&#69;ach p&#97;r<br>&#97;&#103;ai&#110;st <br>("J&#117;dici<br>the<font color=white>i</font>regi<br>such &#108;aw<br>and perf<br>of fed&#101;r<br>&#97;n&#121; acti<br>Se&#114;vice.<br>the abo&#118;<br><br>&nbsp; &nbsp;&nbsp; <b><font color=white>s</font></b>&nbsp; <br><font color=white>f</font><br>You<font color=white>o</font>con&#115;<br>m&#97;&#121; &#97;ppe<br>a&#98;use. T<br>Visitors<br><br>VI&#83;&#73;TO&#82;S<br>PA&#82;TY OR<br>SUBSEQUE<br></font></td>\n<td><font style="font-family: courier, monospace;">&nbsp; &nbsp; &nbsp; &nbsp; <br><br>ite f&#114;&#111;m<br>ubject t<br>&#114;ms gove<br>&#121;ou a&#99;ce<br>m ca&#114;efu<br>&#102; the in<br>e acc&#101;ss<br>sfe&#114;&#97;ble<br><br><br>&nbsp; &nbsp; &nbsp;&nbsp; <b>&#83;</b><br><br>res&#116;rict<br>n<font color=white>k</font>Visi&#116;o<br>&nbsp;b&#111;t&#115;&#44; i<br>&nbsp;designe<br>cal&#108;y.<br><br>dress&#101;&#115; <br>cogni&#122;ed<br>ou ac&#107;no<br>l&#117;e &#110;ot <br>&nbsp;&#97;nd/or <br>&nbsp;&#116;&#104;ese &#97;<br>this W&#101;b<br>t and<font color=white>p</font>ex<br><br>&nbsp; &nbsp; &nbsp; &nbsp; <br><br>ty &#97;gree<br>the othe<br>al<font color=white>i</font>Acti&#111;<br>ster&#101;d A<br>&#115; are ap<br>ormed en<br>al &#97;n&#100; s<br>on<font color=white>e</font>bro&#117;&#103;<br>&nbsp;You con<br>e agr&#101;em<br><br>&nbsp; <b><font color=white>i</font></b>&nbsp; &nbsp;&nbsp; <br><br>ent to h<br>ar some&#119;<br>he Ide&#110;t<br>&nbsp;&#97;g&#114;e&#101; n<br><br>&nbsp;AGREE &#84;<br>&nbsp;SE&#78;D&#73;NG<br>NT BREAC<br></font></td>\n<td><font style="font-family: courier, monospace;">&nbsp;&nbsp; <b><font color=white>o</font></b>&nbsp;&nbsp; <b><font color=white>s</font></b><br><br>&nbsp;&#119;hich &#121;<br>o<font color=white>f</font>th&#101; fo<br>rning ac<br>pt these<br>lly.<font color=white>p</font>&#65;&#110;y<br>divi&#100;ual<br>&nbsp;rights <br>&nbsp;wi&#116;hout<br><br><br><b>PECIAL</b>&nbsp;<b>L</b><br><br>i&#111;ns<font color=white>p</font>on <br>rs. &#78;on-<br>&#110;dexers,<br>d &#116;o acc<br><br><br>on this <br>&nbsp;that &#116;h<br>w&#108;edge a<br>le&#115;&#115;<font color=white>s</font>tha<br>dist&#114;ibu<br>dd&#114;esse&#115;<br>site\'s e<br>press&#108;y <br><br>&nbsp; <b><font color=white>e</font></b>&nbsp; <b><font color=white>t</font><font color=white>f</font></b>&nbsp;<br><br>s &#116;hat a<br>&#114; in con<br>n") shal<br>dminis&#116;r<br>&#112;li&#101;d to<br>tirely w<br>tate cou<br>ht again<br>sent t&#111;<font color=white>c</font><br>ent.<br><br>&nbsp; <b><font color=white>a</font></b>&nbsp; &nbsp;&nbsp; <br><br>av&#105;ng yo<br>here<font color=white>g</font>on <br>ifier is<br>&#111;t to u&#115;<br><br>H&#65;T HAR&#86;<br>&nbsp;ANY M&#69;S<br>H OF T&#72;E<br></font></td>\n<td><font style="font-family: courier, monospace;">&nbsp;&nbsp; <b>TERMS</b><br><br>ou acce&#115;<br>llowing <br>cess<font color=white>a</font>to <br>&nbsp;terms<font color=white>c</font>a<br>&nbsp;Non&#45;H&#117;m<br>(s) w&#104;o <br>granted<font color=white>c</font><br><font color=white>s</font>t&#104;e exp<br><br><br><b>ICEN&#83;E<font color=white>h</font>R</b><br><br>a &#118;isi&#116;o<br>&#72;uman Vi<br>&nbsp;robots,<br>e&#115;s&#44;<font color=white>e</font>re&#97;<br><br><br>&#115;ite ar&#101;<br>&#101;se ema&#105;<br>nd agree<br>n U&#83;<font color=white>h</font>$5&#48;<br>&#116;&#105;on<font color=white>e</font>of <br>. Intent<br>mail &#97;d&#100;<br>prohibi&#116;<br><br>&nbsp;<b>&#65;P&#80;LIC&#65;</b><br><br>ny suit,<br>nectio&#110; <br>l be &#103;ov<br>ative Co<br><font color=white>i</font>a&#103;reeme<br>ithin &#116;h<br>rt&#115; &#119;it&#104;<br>st him<font color=white>a</font>i<br>el&#101;ctron<br><br><br><b>&#82;ECOR&#68;&#83;</b>&nbsp;<br><br>ur Inter<br>this pag<br>&nbsp;uniq&#117;el<br>e this &#97;<br><br>ESTING&#44; <br>S&#65;GE(S) <br>SE TERMS<br></font></td>\n<td><font style="font-family: courier, monospace;">&nbsp;<b>A&#78;D</b>&nbsp;<b>CON</b><br><br>&#115;e&#100; this<br>c&#111;&#110;ditio<br>t&#104;e Webs<br>nd co&#110;di<br>an &#86;isit<br>contro&#108;s<br>to &#121;ou u<br>ress wri<br><br><br><b>ES&#84;RICTI</b><br><br>r\'s l&#105;ce<br>sitors<font color=white>i</font>i<br>&nbsp;crawler<br>&#100;&#44;<font color=white>h</font>co&#109;p&#105;<br><br><br>&nbsp;con&#115;i&#100;e<br>l addres<br>&nbsp;that e&#97;<br>. Y&#111;u f&#117;<br>&#116;&#104;ese ad<br>ional co<br>resses i<br>e&#100;.<br><br><b>BLE</b>&nbsp;<b>LAW</b>&nbsp;<br><br>&nbsp;action <br>with or <br>erned<font color=white>d</font>&#98;y<br>ntact (t<br>nts betw<br>e<font color=white>i</font>Adm&#105;n <br>in the A<br>n<font color=white>p</font>&#99;onnec<br>ic &#115;ervi<br><br><br><b>OF</b>&nbsp;<b>VIS&#73;T</b><br><br>net Prot<br>e (the "<br>y matche<br>ddress &#102;<br><br>GATHERIN<br>TO THE I<br>&nbsp;OF SERV<br></font></td>\n<td><font style="font-family: courier, monospace;"><b>DI&#84;&#73;ONS</b>&nbsp;<br><br>&nbsp;ag&#114;e&#101;me<br>&#110;s. Th&#101;s<br>ite&#46; By <br>tions (t<br>ors t&#111; t<br>, aut&#104;&#111;&#114;<br>nder the<br>tt&#101;&#110;<font color=white>d</font>per<br><br><br><b>ONS</b>&nbsp;<b>FOR</b>&nbsp;<br><br>ns&#101; to a<br>ncl&#117;de, <br>s, harve<br>le &#111;r ga<br><br><br>red &#112;rop<br>&#115;es are <br>ch email<br>rther ag<br>dres&#115;es <br>ll&#101;&#99;tion<br>s recogn<br><br><br><b>AND</b>&nbsp;<b>&#74;URI</b><br><br>or proce<br>a&#114;ising <br>&nbsp;the &#108;&#97;w<br>he "Admi<br>een<font color=white>i</font>&#65;dmi<br>State. Y<br>dmin Sta<br>tion wit<br>ce of pr<br><br><br><b>OR</b>&nbsp;<b>U&#83;E</b>&nbsp;<b>A</b><br><br>o&#99;ol a&#100;d<br>I&#100;entifi<br>d to y&#111;u<br>or &#97;n&#121; r<br><br>G, STOR&#73;<br>DENTIFIE<br>ICE.<br></font></td>\n<td><font style="font-family: courier, monospace;"><b>O&#70;</b>&nbsp;<b>USE<font color=white>c</font></b><br><br>nt ("t&#104;e<br>e<font color=white>k</font>t&#101;rms <br>visitin&#103;<br>he "&#84;erm<br>he Websi<br>s or oth<br>&nbsp;T&#101;rms<font color=white>s</font>o<br>mission <br><br><br><b>&#78;ON&#45;HUMA</b><br><br>cce&#115;s &#116;h<br>but are <br>sters&#44; o<br>ther con<br><br><br>r&#105;&#101;tary <br>provide&#100;<br>&nbsp;&#97;d&#100;ress<br>ree<font color=white>e</font>that<br>substant<br>, &#104;arves<br>ized &#97;s <br><br><br><b>SDICTION</b><br><br>ed&#105;ng &#98;r<br>&#102;rom the<br>&nbsp;of the <br>n<font color=white>f</font>State"<br>n<font color=white>d</font>&#83;&#116;&#97;te <br>ou &#99;onse<br>&#116;e. Y&#111;u <br>h breach<br>oces&#115;<font color=white>s</font>&#114;e<br><br><br><b>ND</b>&nbsp;<b>ABUSE</b><br><br>&#114;e&#115;&#115;<font color=white>f</font>rec<br>er") if <br>r &#73;n&#116;ern<br>e&#97;son.<br><br>NG, TRAN<br>R &#67;ONSTI<br><br></font></td>\n<td><font style="font-family: courier, monospace;"><br><br>&nbsp;We&#98;site<br>are in a<br>&nbsp;(in<font color=white>h</font>a&#110;y<br>&#115; of Ser<br>te shall<br>erwi&#115;e m<br>f S&#101;rvic<br>of t&#104;e o<br><br><br><b>N</b>&nbsp;<b>VISITO</b><br><br>&#101; We&#98;s&#105;t<br>not limi<br>r<font color=white>e</font>any ot<br>tent fro<br><br><br>intellec<br>&nbsp;for hum<br>&nbsp;&#116;he Web<br>&nbsp;th&#101; com<br>iall&#121; &#100;i<br>ting,<font color=white>p</font>ga<br>a viola&#116;<br><br><br>&nbsp;<br><br>ought by<br>&nbsp;Terms o<br>state of<br>) for th<br>&#114;esident<br>&#110;t<font color=white>a</font>to &#116;h<br>cons&#101;n&#116; <br>es of th<br>gar&#100;&#105;n&#103; <br><br><br>&nbsp;<br><br>orde&#100;. &#65;<br>w&#101; suspe<br>e&#116; Pr&#111;to<br><br><br>SF&#69;RRING<br>&#84;UTES AN<br><br></font></td>\n<td><font style="font-family: courier, monospace;"><br><br>")<font color=white>h</font>i&#115; pr<br>dditio&#110;<font color=white>d</font><br>&nbsp;manner)<br>vice"). <br>&nbsp;b&#101; &#99;&#111;ns<br>akes use<br>e are<br>wner<font color=white>g</font>of <br><br><br><b>RS</b>&nbsp;<br><br>e a&#112;ply <br>t&#101;d to&#44;<font color=white>o</font><br>he&#114; &#99;omp<br>m &#116;he &#87;e<br><br><br>tual pro<br>an visit<br>&#115;&#105;te con<br>pi&#108;atio&#110;<br>m&#105;nishes<br>theri&#110;g,<br>ion &#111;f t<br><br><br><br><br>&nbsp;s&#117;ch pa<br>f S&#101;rvi&#99;<br>&nbsp;residen<br>e We&#98;s&#105;t<br>s entere<br>e jur&#105;sd<br>to<font color=white>o</font>the v<br>ese Te&#114;m<br>a&#99;tion&#115; <br><br><br><br><br>&#110; email <br>ct po&#116;en<br>&#99;ol addr<br><br><br>&nbsp;TO &#65;<font color=white>i</font>&#84;H<br><font color=white>t</font>ACC&#69;PTA<br><br></font></td>\n<td><font style="font-family: courier, monospace;"><br><br>ovided<br>to any<br>&nbsp;the<br>Please<br>idered<br><font color=white>f</font>of<br><br>th&#101;<br><br><br><br><br>to<br>web<br>uter<br>b&#115;ite<br><br><br>perty&#46;<br>&#111;rs<br>&#116;a&#105;ns<br>,<br>&nbsp;&#116;he<br>&nbsp;and/or<br>his<br><br><br><br><br>rt&#121;<br>e<br>c&#101; of<br>e<font color=white>c</font>as<br>&#100; into<br>ictio&#110;<br>enue in<br>s &#111;f<br>u&#110;de&#114;<br><br><br><br><br>address<br>tial<br>ess.<br><br><br>IRD<br>NC&#69; AN&#68;<br><br></font></td>\n</tr>\n</table>\n<br>';
}

?><?php 

//
// PROXY SUPPORT
//
// This honey pot script supports Proxies. If your webserver requires a proxy
// for outbound connections you may configure this honey pot's settings to use
// a proxy.
//
// For more information, visit:
//     http://www.projecthoneypot.org/settings_help.php
//
//

function formatHTML($s)
{
    return str_replace('\n', "\n", $s);
}

function getDocType()
{
    return formatHTML(__DOC_TYPE1);
}
function getHeadHTML1()
{
    return formatHTML(__HEAD1);
}
function getRobotHTML()
{
    return formatHTML(__ROBOT1);
}
function getNoCollectHTML()
{
    return formatHTML(__NOCOLLECT1);
}
function getHeadHTML2()
{
    return formatHTML(__HEAD2);
}
function getTopHTML()
{
    return formatHTML(__TOP1);
}
function getEmailHTML($method, $m)
{
    switch ($method) {
    case 0: return '';
    case 1: return formatHTML(__EMAIL1A.$m.__EMAIL1B.$m.__EMAIL1C);
    case 2: return formatHTML(__EMAIL2A.$m.__EMAIL2B.$m.__EMAIL2C);
    case 3: return formatHTML(__EMAIL3A.$m.__EMAIL3B.$m.__EMAIL3C);
    case 4: return formatHTML(__EMAIL4A.$m.__EMAIL4B.$m.__EMAIL4C);
    case 5: return formatHTML(__EMAIL5A.$m.__EMAIL5B);
    case 6: return formatHTML(__EMAIL6A.$m.__EMAIL6B.$m.__EMAIL6C);
    case 7: return formatHTML(__EMAIL7A.$m.__EMAIL7B.$m.__EMAIL7C);
    case 8: return formatHTML(__EMAIL8A.$m.__EMAIL8B.$m.__EMAIL8C);
    case 9: return formatHTML(__EMAIL9A.$m.__EMAIL9B.$m.__EMAIL9C);
    }

    return formatHTML(__EMAIL10A.$m.__EMAIL10B.$m.__EMAIL10C);
}
function getLegalHTML()
{
    return formatHTML(__LEGAL1.(getLegalContent()).__LEGAL2);
}
function getStyleHTML()
{
    return formatHTML(__STYLE1);
}
function getVanityHTML()
{
    return formatHTML(__VANITY1);
}
function getBottomHTML()
{
    return formatHTML(__BOTTOM1);
}

function readSettings()
{
    $settings = null;
    $settings_file = dirname(__FILE__).'/phpot_settings.php';

    if (is_file($settings_file) && is_readable($settings_file)) {
        $fp = fopen($settings_file, 'r');
        $contents = '';
        while (!feof($fp)) {
            $contents .= fread($fp, 8192);
        }
        fclose($fp);

        $lines = explode("\n", $contents);
        foreach ($lines as $line) {
            if (trim($line) !== '') {
                list($setting, $value) = @explode(':', $line, 2);
                switch ($setting) {
                case 'proxy_host':
                    $settings['sock_host'] = trim($value);
                    break;
                case 'proxy_port':
                    $settings['sock_port'] = trim($value);
                    break;
                }
                if (trim($value) !== '') {
                    $settings[trim($setting)] = trim($value);
                }
            }
        }
    }

    if (isset($settings['proxy_host']) && isset($settings['proxy_port']) && !isset($settings['use_proxy'])) {
        $settings['use_proxy'] = '1';
    } else {
        $settings['use_proxy'] = '0';
    }

    if (isset($settings['proxy_user']) && isset($settings['proxy_pass']) && !isset($settings['proxy_auth'])) {
        $settings['proxy_auth'] = 'basic';
    } else {
        $settings['proxy_auth'] = 'none';
    }

    if (!isset($settings['sock_host'])) {
        $settings['sock_host'] = __REQUEST_HOST;
    }
    if (!isset($settings['sock_port'])) {
        $settings['sock_port'] = __REQUEST_PORT;
    }

    return $settings;
}

function performRequest($request)
{
    $response = '';

    $settings = readSettings();

    if ($settings['use_proxy'] == '1') {
        // POST via proxy
        $post_url = 'http://'.__REQUEST_HOST.':'.__REQUEST_PORT.__REQUEST_SCRIPT;

        $head = 'POST '.$post_url." HTTP/1.0\r\n";
        //$head .= "Host: ".__REQUEST_HOST."\r\n";
        $head .= 'User-Agent: PHPot '.__HPOT_TAG2."\r\n";
        if ($settings['proxy_auth'] == 'basic') {
            $head .= 'Proxy-Authorization: Basic '.base64_encode($settings['proxy_user'].':'.$settings['proxy_pass'])."\r\n";
        }
        $head .= "Cache-Control: no-store, no-cache\r\n";
        $head .= "Accept: */*\r\n";
        $head .= "Pragma: no-cache\r\n";
        $head .= "Content-Type: application/x-www-form-urlencoded\r\n";
        $head .= 'Content-Length: '.strlen($request)."\r\n";
        $head .= "Connection: close\r\n\r\n";
    } else {
        // POST directly
        $head = 'POST '.__REQUEST_SCRIPT." HTTP/1.1\r\n";
        $head .= 'Host: '.__REQUEST_HOST."\r\n";
        $head .= 'User-Agent: PHPot '.__HPOT_TAG2."\r\n";
        $head .= "Content-Type: application/x-www-form-urlencoded\r\n";
        $head .= 'Content-Length: '.strlen($request)."\r\n";
        $head .= "Connection: close\r\n\r\n";
    }

    $errno = null;
    $errstr = null;
    $fd = @fsockopen($settings['sock_host'], $settings['sock_port'], $errno, $errstr, 20);

    if (!$fd) {
        // Socket Error
        die("\n<BR>Unable to contact the Server. Are outbound connections disabled? (If a proxy is required for outbound traffic, you may configure the honey pot to use a proxy. For instructions, visit http://www.projecthoneypot.org/settings_help.php)<BR>\n");

        return '-1';
    } else {
        fwrite($fd, $head.$request);
        while (!feof($fd)) {
            $response .= fgets($fd, 4096);
        }
        fclose($fd);
    }

    return $response;
}

function prepareRequest()
{
    $postvars = [];
    $postvars['tag1'] = __HPOT_TAG1;
    $postvars['tag2'] = __HPOT_TAG2;
    $postvars['tag3'] = __HPOT_TAG3;
    if (!($handle = fopen(__FILE__, 'r'))) {
        die("\n<BR>Unable to read contents of ".__FILE__." for hashing<BR>\n");

        return -2;
    }
    $contents = '';
    while (!feof($handle)) {
        $contents .= fread($handle, 8192);
    }
    fclose($handle);
    $postvars['tag4'] = md5(preg_replace('/[^a-zA-Z0-9]/', '', $contents));
    $postvars['ip'] = $_SERVER['REMOTE_ADDR'];
    $postvars['svrn'] = $_SERVER['SERVER_NAME'];
    $postvars['svp'] = $_SERVER['SERVER_PORT'];
    $postvars['svip'] = isset($_SERVER['SERVER_ADDR']) ? $_SERVER['SERVER_ADDR'] : '';
    $postvars['rquri'] = isset($_SERVER['REQUEST_URI']) ? $_SERVER['REQUEST_URI'] : '';
    $postvars['phpself'] = str_replace(' ', '%20', $_SERVER['PHP_SELF']);
    $postvars['version'] = 'php-'.phpversion();
    $postvars['sn'] = str_replace(' ', '%20', $_SERVER['SCRIPT_NAME']);
    $postvars['ref'] = isset($_SERVER['HTTP_REFERER']) ? $_SERVER['HTTP_REFERER'] : '';
    $postvars['uagnt'] = isset($_SERVER['HTTP_USER_AGENT']) ? $_SERVER['HTTP_USER_AGENT'] : '';
    if (isset($_POST) && count($_POST) > 0) {
        $postvars['has_post'] = count($_POST);
        for (reset($_POST); list($k, $v) = each($_POST);) {
            $postvars['post|'.$k] = $v;
        }
        reset($_POST);
    }
    if (isset($_GET) && count($_GET) > 0) {
        $postvars['has_get'] = count($_GET);
        for (reset($_GET); list($k, $v) = each($_GET);) {
            $postvars['get|'.$k] = $v;
        }
        reset($_GET);
    }
    if (isset($_SERVER) && count($_SERVER) > 0) {
        $i = 0;
        for (reset($_SERVER); list($k, $v) = each($_SERVER);) {
            if ($k !== 'HTTP_COOKIE' && preg_match('/^HTTP_/', $k)) {
                $postvars['header|'.$k] = $v;
                $i++;
            }
        }
        $postvars['has_header'] = $i;
        reset($_SERVER);
    }

    return $postvars;
}

function transcribeResponse(&$response)
{
    $settings = null;
    $arr = explode("\n", $response);
    $isParam = false;

    for ($i = 0; list(, $v) = each($arr); $i++) {
        if ($v == '<END>') {
            $isParam = false;
        }

        if ($isParam) {
            $pieces = explode('=', $v, 2);
            $settings[$pieces[0]] = urldecode($pieces[1]);
        }
        if ($v == '<BEGIN>') {
            $isParam = true;
        }
    }

    if (isset($settings['directives'])) {
        $settings['directives'] = explode(',', $settings['directives']);
    }

    return $settings;
}

header('Cache-Control: no-store, no-cache');
header('Pragma: no-cache');

$response = '';
$request = '';
$post = prepareRequest();

for (reset($post); list($k, $v) = each($post);) {
    $request .= '&'.urlencode($k).'='.urlencode(stripslashes($v));
}
$request = substr($request, 1);
$response = performRequest($request);
if ($response == '-1') {
    exit();
}
$settings = transcribeResponse($response);

$directives = $settings['directives'];
$email = isset($settings['email']) ? $settings['email'] : '';
$emailmethod = isset($settings['emailmethod']) ? $settings['emailmethod'] : 0;

?>
<?php echo (isset($directives[0]) && $directives[0] == 1) ? getDocType() : ''; ?>
<?php echo (isset($settings['injDocType'])) ? formatHTML($settings['injDocTypeMsg']) : ''; ?>
<?php echo (isset($directives[1]) && $directives[1] == 1) ? getHeadHTML1() : ''; ?>
<?php echo (isset($settings['injHead1HTML'])) ? formatHTML($settings['injHead1HTMLMsg']) : ''; ?>
<?php echo (isset($directives[8]) && $directives[8] == 1) ? getRobotHTML() : ''; ?>
<?php echo (isset($settings['injRobotHTML'])) ? formatHTML($settings['injRobotHTMLMsg']) : ''; ?>
<?php echo (isset($directives[9]) && $directives[9] == 1) ? getNoCollectHTML() : ''; ?>
<?php echo (isset($settings['injNoCollectHTML'])) ? formatHTML($settings['injNoCollectHTMLMsg']) : ''; ?>
<?php echo (isset($directives[1]) && $directives[1] == 1) ? getHeadHTML2() : ''; ?>
<?php echo (isset($settings['injHead2HTML'])) ? formatHTML($settings['injHead2HTMLMsg']) : ''; ?>
<?php echo (isset($directives[2]) && $directives[2] == 1) ? getTopHTML() : ''; ?>
<?php echo (isset($settings['injTopHTML'])) ? formatHTML($settings['injTopHTMLMsg']) : ''; ?>
<?php
   if (isset($settings['actMsgOn'])) {
       echo formatHTML($settings['actMsg']);
   }
   if (isset($settings['errMsgOn'])) {
       echo formatHTML($settings['errMsg']);
   }
   if (isset($settings['customMsgOn'])) {
       echo formatHTML($settings['customMsg']);
   }
?>
<?php echo (isset($directives[3]) && $directives[3] == 1) ? getLegalHTML() : ''; ?>
<?php echo (isset($settings['injLegalHTML'])) ? formatHTML($settings['injLegalHTMLMsg']) : ''; ?>
<?php
   if (isset($settings['altLegalOn'])) {
       echo formatHTML($settings['altLegalMsg']);
   }
?>
<?php echo (isset($directives[4]) && $directives[4] == 1) ? getEmailHTML(intval($emailmethod), $email) : ''; ?>
<?php echo (isset($settings['injEmailHTML'])) ? formatHTML($settings['injEmailHTMLMsg']) : ''; ?>
<?php echo (isset($directives[5]) && $directives[5] == 1) ? getStyleHTML() : ''; ?>
<?php echo (isset($settings['injStyleHTML'])) ? formatHTML($settings['injStyleHTMLMsg']) : ''; ?>
<?php echo (isset($directives[6]) && $directives[6] == 1) ? getVanityHTML() : ''; ?>
<?php echo (isset($settings['injVanityHTML'])) ? formatHTML($settings['injVanityHTMLMsg']) : ''; ?>
<?php
   if (isset($settings['altVanityOn'])) {
       echo formatHTML($settings['altVanityMsg']);
   }
?>
<?php echo (isset($directives[7]) && $directives[7] == 1) ? getBottomHTML() : ''; ?>
<?php echo (isset($settings['injBottomHTML'])) ? formatHTML($settings['injBottomHTMLMsg']) : ''; ?>
